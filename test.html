<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>IP 테이블 핑 테스트</title>
    <style>
      table {
        width: 50%;
        border-collapse: collapse;
        margin-bottom: 20px;
      }
      table,
      th,
      td {
        border: 1px solid black;
      }
      th,
      td {
        padding: 10px;
        text-align: left;
      }
      textarea {
        width: 50%;
        height: 150px;
        margin-top: 20px;
      }
    </style>
  </head>
  <body>
    <h2>IP 정보 테이블</h2>

    <table id="ipTable">
      <thead>
        <tr>
          <th>IP 주소</th>
          <th>위치</th>
          <th>상태</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>192.168.1.1</td>
          <td>서울</td>
          <td>대기 중</td>
        </tr>
        <tr>
          <td>192.168.1.2</td>
          <td>부산</td>
          <td>대기 중</td>
        </tr>
        <tr>
          <td>192.168.1.3</td>
          <td>대구</td>
          <td>대기 중</td>
        </tr>
      </tbody>
    </table>

    <h2>핑 결과</h2>
    <textarea id="pingResult" readonly></textarea>

    <button id="pingButton">핑 시작</button>

    <script>
      // 서버에 핑 요청을 보내는 함수
      async function pingIP(ip) {
        try {
          const response = await fetch(`/ping?ip=${ip}`); // 서버의 /ping 엔드포인트에 IP 전달
          const data = await response.json();
          return data.result; // 서버에서 반환한 핑 결과
        } catch (error) {
          return `핑 실패: ${error.message}`;
        }
      }

      // 테이블의 IP를 순차적으로 핑하고 결과를 업데이트
      async function pingAllIPs() {
        const table = document.getElementById("ipTable").getElementsByTagName("tbody")[0];
        const rows = table.getElementsByTagName("tr");
        const pingResult = document.getElementById("pingResult");

        pingResult.value = "핑을 시작합니다...\n";

        for (let i = 0; i < rows.length; i++) {
          const ip = rows[i].getElementsByTagName("td")[0].innerText;
          const statusCell = rows[i].getElementsByTagName("td")[2];

          // 상태를 "핑 중..."으로 업데이트
          statusCell.innerText = "핑 중...";

          // 서버에 핑 요청 보내기
          const result = await pingIP(ip);

          // 상태와 결과 업데이트
          statusCell.innerText = result.includes("실패") ? "오프라인" : "온라인";
          pingResult.value += `IP: ${ip} - ${result}\n`;
        }

        pingResult.value += "핑 완료!\n";
      }

      // 버튼 클릭 시 핑 시작
      document.getElementById("pingButton").addEventListener("click", pingAllIPs);
    </script>
  </body>
</html>
